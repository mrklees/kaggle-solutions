---
title: "Titanic Exploration Using Random Forests"
author: "Alex Perusse"
output:
  html_document:
    toc: TRUE
---

```{r Packages, message=FALSE, warning=FALSE}
library(dplyr) # Data manipulation

library(ggthemes) #Plots
library(ggplot2)

library(mice) #Filling in missing data

library(randomForest) #Random Forest Classification Model
```

```{r Load Data}
setwd("C:/Users/Alexander/OneDrive/GitHub/kaggle-solutions/Titanic")
train <- read.csv("train.csv")
test <- read.csv("test.csv")
```

# Data Exploration
To start, I wanted to think about what might be some good independent fields to include.  Gender seemed like a good place to start.  

```{r Gender Survival}
Sex_Survival <- train %>%
  group_by(Sex) %>%
  summarise(count = n(),
            survived = sum(Survived),
            died = count - survived,
            survival_rate = survived/n())

mosaicplot(table(train$Sex,train$Survived), main = 'Gender vs. Survival', sub = '0 = Survived and 1 = Died')
```

Might just be me, but I think Gender might be a good feature for us.
We'll look at Age next.  The first graph shows the density of those who lived and those who died.  
The second graph plots Age versus the survival rate for passengers of that age.  

```{r Survival by Age}
Age_Survival <- train %>%
  group_by(Age) %>%
  summarise(survived = sum(Survived)/n())
#buckets <- ntile(Age_Survival$Age,4)
#Age_Survival <- bind_cols(Age_Survival,buckets)

hist(train$Age, plot = TRUE)

ggplot(train, aes(x = Age, y = Survived)) +
  geom_count()

ggplot(Age_Survival, aes(x = Age, y = survived)) +
  geom_line()
```

# Feature Engineering
I will go ahead and perform some center-scaling. There is some missing data as well that I will use mice to fill.

```{r Family Size}
train <- train %>%
  mutate(Family_Size = SibSp + Parch)

test <- test %>%
  mutate(Family_Size = SibSp + Parch)
```

```{r Fill holes in data}
factor_vars = c('Pclass', 'Sex', 'Age', 'SibSp', 'Parch', 'Fare', 'Embarked')
for (var in factor_vars) {
  print(c(var, sum(is.na(train[[var]]))))
}
```
We can see that Age has a significant number of missing data points.  While I'm okay losing one point for Fare, I would like to not lose all of those Age data points since it constitutes about a quarter of the training set.  
```{r Remove unused columns}
train <- train %>%
  mutate(Bin_Sex = as.integer(Sex == "female"))
  
  
train <- select(train, Survived, Pclass, Bin_Sex, Age, SibSp, Parch, Fare, Embarked)
  
str(train)
```